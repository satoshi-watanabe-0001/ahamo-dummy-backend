{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://api.online-contract.example.com/schemas/common.json",
  "title": "オンライン契約システム 共通スキーマ定義",
  "description": "SCRUM-77: API仕様統一設計用の共通JSON Schema",
  
  "definitions": {
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601形式のタイムスタンプ",
      "examples": ["2024-12-20T10:30:00Z", "2024-12-20T19:30:00+09:00"]
    },
    
    "date": {
      "type": "string",
      "format": "date",
      "description": "ISO 8601形式の日付",
      "examples": ["2024-12-20"]
    },
    
    "uuid": {
      "type": "string",
      "format": "uuid",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
      "description": "UUID v4形式",
      "examples": ["550e8400-e29b-41d4-a716-446655440000"]
    },
    
    "email": {
      "type": "string",
      "format": "email",
      "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$",
      "description": "有効なメールアドレス",
      "examples": ["user@example.com"]
    },
    
    "phone_number": {
      "type": "string",
      "pattern": "^(\\+81-?|0)\\d{1,4}-?\\d{1,4}-?\\d{4}$",
      "description": "日本の電話番号形式",
      "examples": ["090-1234-5678", "+81-90-1234-5678", "03-1234-5678"]
    },
    
    "postal_code": {
      "type": "string",
      "pattern": "^\\d{3}-\\d{4}$",
      "description": "日本の郵便番号形式",
      "examples": ["100-0001", "160-0022"]
    },
    
    "currency_amount": {
      "type": "number",
      "multipleOf": 0.01,
      "minimum": 0,
      "description": "通貨金額（円）",
      "examples": [2980, 124800, 10.50]
    },
    
    "percentage": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "description": "パーセンテージ（0-100）",
      "examples": [75.5, 100, 0]
    },
    
    "pagination": {
      "type": "object",
      "properties": {
        "page": {
          "type": "integer",
          "minimum": 1,
          "description": "現在のページ番号"
        },
        "limit": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "description": "1ページあたりの件数"
        },
        "total": {
          "type": "integer",
          "minimum": 0,
          "description": "総件数"
        },
        "total_pages": {
          "type": "integer",
          "minimum": 0,
          "description": "総ページ数"
        },
        "has_next": {
          "type": "boolean",
          "description": "次のページが存在するか"
        },
        "has_prev": {
          "type": "boolean",
          "description": "前のページが存在するか"
        }
      },
      "required": ["page", "limit", "total", "total_pages", "has_next", "has_prev"],
      "additionalProperties": false
    },
    
    "error_response": {
      "type": "object",
      "properties": {
        "error_code": {
          "type": "string",
          "description": "エラーコード",
          "enum": [
            "VALIDATION_ERROR",
            "AUTHENTICATION_ERROR", 
            "AUTHORIZATION_ERROR",
            "RESOURCE_NOT_FOUND",
            "RESOURCE_CONFLICT",
            "RATE_LIMIT_EXCEEDED",
            "INTERNAL_ERROR",
            "SERVICE_UNAVAILABLE",
            "EXTERNAL_SERVICE_ERROR"
          ]
        },
        "message": {
          "type": "string",
          "description": "エラーメッセージ"
        },
        "details": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "field": {
                "type": "string",
                "description": "エラーが発生したフィールド名"
              },
              "code": {
                "type": "string",
                "description": "フィールド固有のエラーコード"
              },
              "message": {
                "type": "string",
                "description": "フィールド固有のエラーメッセージ"
              }
            },
            "required": ["field", "code", "message"],
            "additionalProperties": false
          },
          "description": "詳細エラー情報"
        },
        "request_id": {
          "$ref": "#/definitions/uuid",
          "description": "リクエストID"
        },
        "timestamp": {
          "$ref": "#/definitions/timestamp",
          "description": "エラー発生時刻"
        }
      },
      "required": ["error_code", "message", "request_id", "timestamp"],
      "additionalProperties": false
    },
    
    "success_response": {
      "type": "object",
      "properties": {
        "message": {
          "type": "string",
          "description": "成功メッセージ"
        },
        "request_id": {
          "$ref": "#/definitions/uuid"
        },
        "timestamp": {
          "$ref": "#/definitions/timestamp"
        }
      },
      "required": ["message", "request_id", "timestamp"],
      "additionalProperties": false
    },
    
    "address": {
      "type": "object",
      "properties": {
        "postal_code": {
          "$ref": "#/definitions/postal_code"
        },
        "prefecture": {
          "type": "string",
          "enum": [
            "北海道", "青森県", "岩手県", "宮城県", "秋田県", "山形県", "福島県",
            "茨城県", "栃木県", "群馬県", "埼玉県", "千葉県", "東京都", "神奈川県",
            "新潟県", "富山県", "石川県", "福井県", "山梨県", "長野県", "岐阜県",
            "静岡県", "愛知県", "三重県", "滋賀県", "京都府", "大阪府", "兵庫県",
            "奈良県", "和歌山県", "鳥取県", "島根県", "岡山県", "広島県", "山口県",
            "徳島県", "香川県", "愛媛県", "高知県", "福岡県", "佐賀県", "長崎県",
            "熊本県", "大分県", "宮崎県", "鹿児島県", "沖縄県"
          ],
          "description": "都道府県"
        },
        "city": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50,
          "description": "市区町村"
        },
        "address_line1": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "住所1（町域・番地）"
        },
        "address_line2": {
          "type": "string",
          "maxLength": 100,
          "description": "住所2（建物名等）"
        },
        "building": {
          "type": "string",
          "maxLength": 100,
          "description": "建物名・部屋番号"
        }
      },
      "required": ["postal_code", "prefecture", "city", "address_line1"],
      "additionalProperties": false
    },
    
    "person_name": {
      "type": "object",
      "properties": {
        "first_name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50,
          "description": "名前（名）"
        },
        "last_name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50,
          "description": "名前（姓）"
        },
        "first_name_kana": {
          "type": "string",
          "pattern": "^[ァ-ヴー]+$",
          "minLength": 1,
          "maxLength": 50,
          "description": "名前カナ（名）"
        },
        "last_name_kana": {
          "type": "string",
          "pattern": "^[ァ-ヴー]+$",
          "minLength": 1,
          "maxLength": 50,
          "description": "名前カナ（姓）"
        }
      },
      "required": ["first_name", "last_name", "first_name_kana", "last_name_kana"],
      "additionalProperties": false
    },
    
    "contract_status": {
      "type": "string",
      "enum": ["draft", "pending_ekyc", "pending_payment", "active", "cancelled", "suspended"],
      "description": "契約ステータス"
    },
    
    "device_category": {
      "type": "string", 
      "enum": ["iPhone", "Android"],
      "description": "機種カテゴリ"
    },
    
    "price_range": {
      "type": "string",
      "enum": ["entry", "mid", "premium"],
      "description": "価格帯"
    },
    
    "payment_method_type": {
      "type": "string",
      "enum": ["credit_card", "convenience_store", "bank_transfer"],
      "description": "決済方法タイプ"
    },
    
    "gender": {
      "type": "string",
      "enum": ["male", "female", "other"],
      "description": "性別"
    },
    
    "ekyc_status": {
      "type": "string",
      "enum": ["pending", "in_progress", "completed", "failed", "expired"],
      "description": "eKYC本人確認ステータス"
    },
    
    "document_type": {
      "type": "string",
      "enum": ["drivers_license", "passport", "residence_card"],
      "description": "本人確認書類タイプ"
    },
    
    "option_category": {
      "type": "string",
      "enum": ["insurance", "accessory", "service"],
      "description": "オプションカテゴリ"
    },
    
    "api_metadata": {
      "type": "object",
      "properties": {
        "api_version": {
          "type": "string",
          "pattern": "^v\\d+(\\.\\d+)*$",
          "description": "APIバージョン"
        },
        "request_id": {
          "$ref": "#/definitions/uuid"
        },
        "timestamp": {
          "$ref": "#/definitions/timestamp"
        },
        "environment": {
          "type": "string",
          "enum": ["production", "staging", "development"],
          "description": "実行環境"
        }
      },
      "required": ["api_version", "request_id", "timestamp"],
      "additionalProperties": false
    }
  }
} 